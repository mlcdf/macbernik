"use strict";!function($,window,document,undefined){$.MB_Core=function(element,options){var defaults={},self=this;self.settings={};var registeredPlugins=[],registeredEvents={};return self.init=function(){self.settings=$.extend({},defaults,options)},self.pluginRegister=function(pluginName,selector,options){self.pluginName===undefined&&(self[pluginName]=selector===undefined?eval("$."+pluginName+"("+options+")"):eval("$(selector)."+pluginName+"("+options+")"),registeredPlugins.push(pluginName))},self.eventRegister=function(e,n){registeredEvents.hasOwnProperty(e)?registeredEvents[e].push(n):registeredEvents[e]=[n]},self.onEvent=function(eventName){for(var _len=arguments.length,param=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)param[_key-1]=arguments[_key];var args=arguments;registeredEvents.hasOwnProperty(eventName)&&registeredEvents[eventName].forEach(function(listener){eval("self."+listener+"."+eventName+"(...param)")})},self.init(),self},$.fn.MB_Core=function(e){var n=null;return this.each(function(){undefined==$(this).data("MB_Core")&&(n=new $.MB_Core(this,e),$(this).data("MB_Core",n))}),n}}(jQuery,window,document),function(e){e.MB_Logger=function(n,t){var o={history:[],limit:13},r=this;r.logger_settings={};var i=e(n);r.init=function(){r.logger_settings=e.extend({},o,t),i.empty(),mbCore.eventRegister("onAddMessage","MB_Logger")};var s=function(){r.logger_settings.limit<r.logger_settings.history.length&&i.children().first().remove()};return r.onAddMessage=function(n){var t=e("<li>");t.html(n),i.append(t),r.logger_settings.history.push(n),s()},r.init(),r.getLimit=function(){return r.logger_settings.limit},r.getHistory=function(){return r.logger_settings.history},r},e.fn.MB_Logger=function(n){var t=null;return this.each(function(){void 0==e(this).data("MB_Logger")&&(t=new e.MB_Logger(this,n),e(this).data("MB_Logger",t))}),t}}(jQuery),function(e,n,t,o){e.MB_Scorer=function(n,t){var o={SCORELIMIT:500,BONUSLIMIT:5,BONUSVALUE:50,BESTSCORELIMIT:8,scoreP1:0,scoreP2:0,bonusP1:1,bonusP2:1},r=this;return r.params={},r.init=function(){r.params=e.extend({},o,t),mbCore.eventRegister("onIncreaseScore","MB_Scorer"),mbCore.eventRegister("onIncreaseBonus","MB_Scorer"),mbCore.eventRegister("onResetBonus","MB_Scorer"),mbCore.eventRegister("onAddABestScore","MB_Scorer")},r.isABestScore=function(e){var n=localStorage.getItem("bestScores");if(null!=n){var t=JSON.parse(n);return t[(t.length<o.BESTSCORELIMIT?t.length:o.BESTSCORELIMIT)-1].nb_tours>e}return!0},r.onAddABestScore=function(e){var n=localStorage.getItem("bestScores");if(null!=n){var t=JSON.parse(n);t.push({nb_tours:e}),t.sort(function(e,n){return e.nb_tours-n.nb_tours}),t.length==r.params.BESTSCORELIMIT+1&&t.pop(),localStorage.setItem("bestScores",JSON.stringify(t))}else n=[{nb_tours:e}],localStorage.setItem("bestScores",JSON.stringify(n))},r.isWinnerByScore=function(e){return e>=o.SCORELIMIT},r.onIncreaseBonus=function(e){1==e&&r.params.bonusP1<r.params.BONUSLIMIT&&(r.params.bonusP1+=1),2==e&&r.params.bonusP2<r.params.BONUSLIMIT&&(r.params.bonusP2+=1)},r.onResetBonus=function(e){1==e&&(r.params.bonusP1=1),2==e&&(r.params.bonusP2=1)},r.onIncreaseScore=function(e,n){1==e&&(r.params.scoreP1=r.params.bonusP1>=r.params.BONUSLIMIT?r.params.scoreP1+=n+r.params.BONUSVALUE:r.params.scoreP1+=n),2==e&&(r.params.scoreP2=r.params.bonusP2>=r.params.BONUSLIMIT?r.params.scoreP2+=n+r.params.BONUSVALUE:r.params.scoreP2+=n)},r.getScore=function(e){return 1==e?r.params.scoreP1:2==e?r.params.scoreP2:void 0},r.getBonus=function(e){return 1==e?r.params.bonusP1:2==e?r.params.bonusP2:void 0},r.init(),r},e.fn.MB_Scorer=function(n){var t=null;return this.each(function(){void 0==e(this).data("MB_Scorer")&&(t=new e.MB_Scorer(this,n),e(this).data("MB_Scorer",t))}),t}}(jQuery,window,document),function(e){e.MB_Displayer=function(n,t){function o(e){return(self.settings.cellSideLenght+self.settings.cellBorderWidth)*(e-3)}function r(){e(".show-help-js, .quit-help-js").on("click",function(){c.css("z-index","100"),c.fadeToggle()})}function i(){e(".show-leaderboard-js, .quit-leaderboard-js").on("click",function(){l.fadeToggle()})}var s={cellSideLenght:67,cellBorderWidth:2,bonusLimit:5},a=e(".menu"),u=e(".game"),l=e(".leaderboard"),c=e(".help"),m=e("#player"),g=e(".score"),f=e("#board-game"),d=e(".combo-chain"),p=e(".victory-modal");return self.coinColor={10:"copper",20:"bronze",30:"silver",50:"duo",100:"gold"},self.init=function(){self.settings=e.extend({},s,t),p.hide(),self.setComboChain(1,0),self.setComboChain(2,0),e(window).on("load resize",function(){e(window).width()<=500&&(self.settings.cellSideLenght=47),e(window).width()>500&&(self.settings.cellSideLenght=67)}),e("[class*=start-game]").on("click",function(){self.hideMenuAndShowGame()}),e(".show-menu-js").on("click",function(){self.hideGameAndShowMenu()}),e(".show-leaderboard-js").on("click",function(){self.fillLeaderBoard()}),l.hide(),c.hide(),r(),i(),mbCore.eventRegister("removeCoin","MB_Displayer"),mbCore.eventRegister("setPlayerPosition","MB_Displayer"),mbCore.eventRegister("setScore","MB_Displayer"),mbCore.eventRegister("setComboChain","MB_Displayer"),mbCore.eventRegister("initGame","MB_Displayer"),mbCore.eventRegister("setBonus","MB_Displayer"),mbCore.eventRegister("showVictoryModal","MB_Displayer"),mbCore.eventRegister("displayLastCoinRemoved","MB_Displayer"),mbCore.eventRegister("switchPLayerAsset","MB_Displayer")},self.setScore=function(e,n){g.find(".js-score-"+e).text(n+" £")},self.setComboChain=function(e,n){d.find(".p"+e+"-js .counter").text(n+"/"+self.settings.bonusLimit)},self.displayLastCoinRemoved=function(n,t){var o=e('<div class="coin '+self.coinColor[t]+'">\n                <span>'+t+"</span>\n            </div>");d.find(".p"+n+"-js .js-value .coin:first").remove(),d.find(".p"+n+"-js .js-value").append(o)},self.setBonus=function(n,t){e(".p"+n+"-js .bonus .value").text(t+" £")},self.setPlayerPosition=function(e,n){m.css("transform","translate("+o(n)+"px, "+o(e)+"px)"),mbCore.onEvent("switchPLayerAsset")},self.putCoin=function(n,t,o){var r=e('<div class="coin '+self.coinColor[o]+'">\n                <span>'+o+"</span>\n            </div>");f.find("#"+n+"_"+t).append(r)},self.removeCoin=function(e,n){f.find("#"+e+"_"+n+" .coin").remove()},self.showVictoryModal=function(e){console.log("test"),alert("Le joueur "+e+" a gagné la partie !!!\n                Appuyer sur OK pour revenir au menu principal."),location.reload()},self.hideVictoryModal=function(){p.hide(300)},self.hideGameAndShowMenu=function(){u.fadeOut(300),a.fadeIn(300)},self.switchPLayerAsset=function(){"images/victor_noir.png"==m.find("img").first().attr("src")?m.find("img").first().attr("src","images/victor_roux.png"):m.find("img").first().attr("src","images/victor_noir.png")},self.hideMenuAndShowGame=function(){a.fadeOut(300),u.fadeIn(300)},self.fillLeaderBoard=function(){var n=e(".best-score_items"),t=JSON.parse(localStorage.getItem("bestScores"));e(t).each(function(t,o){var r=e("<tr>"),i=e("<td class='text-center'>");i.append(o.nb_tours),r.append(i),n.append(r)})},self.init(),self},e.fn.MB_Displayer=function(n){var t=null;return this.each(function(){void 0==e(this).data("MB_Displayer")&&(t=new e.MB_Displayer(this,n),e(this).data("MB_Displayer",t))}),t}}(jQuery),function(e){e.MB_GameEngine=function(n,t){var o={size:7,pieces:[{value:100,count:1},{value:50,count:5},{value:30,count:14},{value:20,count:14},{value:10,count:14}],playerOne:"Joueur 1",playerTwo:"Joueur 2",playerPosition:{column:3,line:3}},r=void 0,i=void 0,s=1,a=[0,0,0],u=1,l=this,c=!1,m=0;l.settings={};var g=function(){r[l.settings.playerPosition.column][l.settings.playerPosition.line]=0;var n=[],t=0,o=0;for(e(l.settings.pieces).each(function(e,o){for(t=0;t<o.count;t++)n.push(o.value)}),t=0;t<l.settings.size;t++)for(o=0;o<l.settings.size;o++){for(var i=f(0,n.length-1),s=n[i];100==s&&(3==t||3==o);)i=f(0,n.length-1),s=n[i];t==l.settings.playerPosition.column&&o==l.settings.playerPosition.line||(r[t][o]=s,mbCore.MB_Displayer.putCoin(t,o,s),n.splice(i,1))}},f=function(e,n){return Math.floor(Math.random()*(n-e+1)+e)};l.init=function(){l.settings=e.extend({},o,t),r=d(l.settings.size),g(),i=e(".coin"),p(),mbCore.eventRegister("setPlayerPosition","MB_GameEngine"),mbCore.eventRegister("onAIPlayed","MB_GameEngine"),c=!0,e(".start-game-multi-js").on("click",function(){l.enableIA(!1),mbCore.onEvent("onStopFadeOutAudio")}),e(".start-game-easy-js").on("click",function(){l.enableIA(!0),mbCore.MB_AI.setDifficulty("easy"),mbCore.onEvent("onStopFadeOutAudio")}),e(".start-game-medium-js").on("click",function(){l.enableIA(!0),mbCore.MB_AI.setDifficulty("normal"),mbCore.onEvent("onStopFadeOutAudio")})},l.isMovePossible=function(e,n){return 0!==r[e][n]&&(l.settings.playerPosition.column==n||l.settings.playerPosition.line==e)},l.getSize=function(){return l.settings.size},l.setPlayerPosition=function(e,n){l.settings.playerPosition.column=n,l.settings.playerPosition.line=e},l.removeCoin=function(e,n){var t=r[e][n];return r[e][n]=0,t},l.getPiece=function(e,n){return r[e][n]},l.getPlayerPosition=function(){return l.settings.playerPosition},l.enableIA=function(e){l.settings.ia=e};var d=function(e){for(var n=new Array(e),t=0;t<n.length;t++)n[t]=new Array(e);for(var o=0;o<n.length;o++)for(var r=0;r<n.length;r++)n[o][r]=0;return n},p=function(){i.each(function(){var n=e(this),t=void 0,o=void 0;n.on("click",function(){if(1==c){c=!1;var e=n.parent().attr("id").split("_");t=e[0],o=e[1],b(t,o)}})})},v=function(){for(var e=0;e<7;e++)for(var n=0;n<7;n++)if(l.isMovePossible(e,n))return!1;return!0},b=function(e,n){if(l.isMovePossible(e,n)){mbCore.onEvent("setPlayerPosition",e,n),mbCore.onEvent("removeCoin",e,n);var t=l.removeCoin(e,n);h(t),M(),s=1===s?2:1,u++,l.settings.ia&&2==s?setTimeout(function(){mbCore.onEvent("onAIPlay",m)},700):c=!0}else c=!0},h=function(e){a[s]==e?mbCore.onEvent("onIncreaseBonus",s):mbCore.onEvent("onResetBonus",s);var n=1==s?mbCore.MB_Scorer.params.bonusP1:mbCore.MB_Scorer.params.bonusP2;mbCore.onEvent("setComboChain",s,n),a[s]=e,mbCore.onEvent("displayLastCoinRemoved",s,e),mbCore.onEvent("onIncreaseScore",s,e);var t=mbCore.MB_Scorer.getScore(s);mbCore.onEvent("setScore",s,t),mbCore.onEvent("onAddMessage","Le joueur "+s+" a gagné "+e+" £"),mbCore.MB_Scorer.getBonus(s)>=5&&mbCore.onEvent("setBonus",s,mbCore.MB_Scorer.params.BONUSVALUE)},M=function(){mbCore.MB_Scorer.isWinnerByScore(mbCore.MB_Scorer.getScore(s))&&(mbCore.MB_Scorer.isABestScore(u)&&mbCore.onEvent("onAddABestScore",u),mbCore.onEvent("showVictoryModal",s),mbCore.onEvent("onAddMessage","Le joueur "+s+" a gagné la partie !!")),v()&&(mbCore.MB_Scorer.isABestScore(u)&&mbCore.onEvent("onAddABestScore",u),mbCore.onEvent("showVictoryModal",1===s?2:1),mbCore.onEvent("onAddMessage","Le joueur "+s===1?2:"1 a gagné la partie !!"))};return l.onAIPlayed=function(e){b(e.line,e.column),m=l.getPiece(e.line,e.column)},l.init(),l},e.fn.MB_GameEngine=function(n){var t=null;return this.each(function(){void 0==e(this).data("MB_GameEngine")&&(t=new e.MB_GameEngine(this,n),e(this).data("MB_GameEngine",t))}),t}}(jQuery),function(e){e.MB_AI=function(n,t){var o={difficulty:"easy"},r=this;r.AI_param={},r.init=function(){r.AI_param=e.extend({},o,t),mbCore.eventRegister("onAIPlay","MB_AI")},r.setDifficulty=function(e){r.AI_param.difficulty=e};var i=function(e){return"easy"==r.AI_param.difficulty?c():s(e)};r.onAIPlay=function(e){var n=i(e);mbCore.onEvent("onAIPlayed",n)};var s=function(n){var t=mbCore.MB_GameEngine.getPlayerPosition(),o=a(t.line,t.column);o.sort(function(e,n){return n.value-e.value});var r=void 0;return e(o).each(function(e,t){if(t.value==n)return r=t,!1}),0!=o.length&&void 0==r&&(r=o[0]),r},a=function(e,n){var t=[],o=void 0;e=parseInt(e),n=parseInt(n);for(var r=e-1;r>=0;r--)0!=(o=mbCore.MB_GameEngine.getPiece(r,n))&&"number"==typeof o&&t.push({line:r,column:n,value:o});for(var i=n+1;i<mbCore.MB_GameEngine.settings.size;i++)0!=(o=mbCore.MB_GameEngine.getPiece(e,i))&&"number"==typeof o&&t.push({line:e,column:i,value:o});for(var s=e+1;s<mbCore.MB_GameEngine.settings.size;s++)0!=(o=mbCore.MB_GameEngine.getPiece(s,n))&&"number"==typeof o&&t.push({line:s,column:n,value:o});for(var a=n-1;a>=0;a--)0!=(o=mbCore.MB_GameEngine.getPiece(e,a))&&"number"==typeof o&&t.push({line:e,column:a,value:o});return t},u=function(e,n,t){var o=[],r=void 0;switch(n=parseInt(n),t=parseInt(t),e){case 0:for(var i=n-1;i>=0;i--)0!=(r=mbCore.MB_GameEngine.getPiece(i,t))&&"number"==typeof r&&o.push({line:i,column:t});break;case 1:for(var s=t+1;s<mbCore.MB_GameEngine.settings.size;s++)0!=(r=mbCore.MB_GameEngine.getPiece(n,s))&&"number"==typeof r&&o.push({line:n,column:s});break;case 2:for(var a=n+1;a<mbCore.MB_GameEngine.settings.size;a++)0!=(r=mbCore.MB_GameEngine.getPiece(a,t))&&"number"==typeof r&&o.push({line:a,column:t});break;case 3:for(var u=t-1;u>=0;u--)0!=(r=mbCore.MB_GameEngine.getPiece(n,u))&&"number"==typeof r&&o.push({line:n,column:u})}return o},l=function(e,n){return Math.floor(Math.random()*(n-e+1)+e)},c=function(){for(var e=mbCore.MB_GameEngine.getPlayerPosition(),n=l(0,3),t=u(n,e.line,e.column),o=0;0==t.length&&o<4;)3==n?(n=0,o++):(n++,o++),t=u(n,e.line,e.column);return 0==t.length?(console.log("Erreur, fin du jeu, aucun move possible"),null):t[l(0,t.length-1)]};return r.init(),r},e.fn.MB_AI=function(n){var t=null;return this.each(function(){void 0==e(this).data("MB_AI")&&(t=new e.MB_AI(this,n),e(this).data("MB_AI",t))}),t}}(jQuery),function(e,n,t,o){e.MB_AudioManager=function(n,t){var o={},r=this,i=e(n);r.am_settings={};r.init=function(){r.am_settings=e.extend({},o,t),mbCore.eventRegister("onPlayAudio","MB_AudioManager"),mbCore.eventRegister("onStopFadeOutAudio","MB_AudioManager")};var s=function(e){i.volume=0,i.attr("src","/audio/"+e+".mp3"),i.attr("type","audio/mpeg"),i.trigger("play"),i.animate({volume:1},300)},a=function(){i.animate({volume:0},300),i.trigger("pause"),i.prop("currentTime",0)};return r.onPlayAudio=function(e){s(e)},r.onStopFadeOutAudio=function(){a()},r.init(),r},e.fn.MB_AudioManager=function(n){var t=null;return this.each(function(){void 0==e(this).data("MB_AudioManager")&&(t=new e.MB_AudioManager(this,n),e(this).data("MB_AudioManager",t))}),t}}(jQuery,window,document);var mbCore;$(document).ready(function(){mbCore=$.MB_Core(),mbCore.pluginRegister("MB_Logger","#logger ul"),mbCore.pluginRegister("MB_Scorer"),mbCore.pluginRegister("MB_Displayer"),mbCore.pluginRegister("MB_GameEngine","#board-game"),mbCore.pluginRegister("MB_AI"),mbCore.pluginRegister("MB_AudioManager","audio"),mbCore.onEvent("onPlayAudio","theme")});